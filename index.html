<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Random Garbled Feed (RGF)</title>
<link rel="stylesheet" href="style.css">
<!-- LZ-String for compression -->
<script src="https://cdn.jsdelivr.net/npm/lz-string@1.4.4/libs/lz-string.min.js"></script>
</head>
<body>
<header class="site-header">
  Random Garbled Feed (RGF)
  <a id="download-source" class="download-btn" href="https://github.com/akenno-website/akenno-website.github.io/archive/refs/heads/main.zip" download="akenno-website.zip">
    Download Source
  </a>
</header>

<div class="feed" id="feed"></div>
<div class="loading" id="loading">Loading more noise...</div>

<script>
const feed = document.getElementById('feed');
const loading = document.getElementById('loading');
let mainFeed = []; // store posts

// --- Helpers ---
function generateGarbledText(length){
  const chars='          EEEEEeeeeettttaaaaOOOOooooIIIiiiNNnnSSSSssssHHHhhhRRRrrrDDDdddLLLlllCCCcccUUUuuuMMmmWWwwFFffGGggYYyyPPppBbvVKkJjXxQqZz0123456789';
  let s=''; for(let i=0;i<length;i++){ s+=chars.charAt(Math.floor(Math.random()*chars.length)); } 
  return s;
}

function createDateString(){
  const now=new Date();
  const past=new Date(now.getTime() - Math.random()*30*24*60*60*1000);
  return past.toLocaleDateString('en-US',{month:'short',day:'numeric'});
}

function showShareOverlay(link) {
  const overlay = document.createElement('div');
  overlay.className = 'share-overlay';
  
  const box = document.createElement('div');
  box.className = 'share-box';
  
  const input = document.createElement('input');
  input.type = 'text';
  input.value = link;
  input.readOnly = true;
  input.select();
  
  const copyBtn = document.createElement('button');
  copyBtn.textContent = 'Copy';
  copyBtn.addEventListener('click', () => {
    navigator.clipboard.writeText(link);
    alert('Copied!');
    overlay.remove();
  });
  
  const closeBtn = document.createElement('button');
  closeBtn.textContent = '×';
  closeBtn.addEventListener('click', () => overlay.remove());
  
  box.appendChild(input);
  box.appendChild(copyBtn);
  box.appendChild(closeBtn);
  overlay.appendChild(box);
  document.body.appendChild(overlay);
}

// --- Seeded PRNG ---
function mulberry32(a){
  return function(){
    var t = a += 0x6D2B79F5;
    t = Math.imul(t ^ t>>>15, t | 1);
    t ^= t + Math.imul(t ^ t>>>7, t | 61);
    return ((t ^ t>>>14) >>> 0) / 4294967296;
  }
}

// Generate noise canvas from seed
function generateNoiseFromSeed(seed, width=50, height=50){
  const rand = mulberry32(seed);
  const canvas = document.createElement('canvas'); canvas.width=width; canvas.height=height;
  const ctx = canvas.getContext('2d');
  const imgData = ctx.createImageData(width,height);
  for(let i=0;i<imgData.data.length;i+=4){
    imgData.data[i] = rand()*256;
    imgData.data[i+1] = rand()*256;
    imgData.data[i+2] = rand()*256;
    imgData.data[i+3] = 255;
  }
  ctx.putImageData(imgData,0,0);
  return canvas;
}

// --- Encode/decode post data with backward compatibility ---
function encodePostData(data){ 
    // New posts use LZ-string compression
    return LZString.compressToEncodedURIComponent(JSON.stringify(data));
}

function decodePostData(str){
    // Try LZ-string first
    try {
        const jsonStr = LZString.decompressFromEncodedURIComponent(str);
        if (jsonStr) return JSON.parse(jsonStr);
    } catch(e){}
    // Fallback to plain Base64 for old links
    try {
        return JSON.parse(atob(str));
    } catch(e){}
    return null;
}

// --- Replies ---
function createReplyElement(text){
  const r = document.createElement('div'); r.className='reply';
  const u = document.createElement('span'); u.className='reply-username'; u.textContent=generateGarbledText(5);
  const t = document.createElement('span'); t.className='reply-text'; t.textContent=text;
  r.appendChild(u); r.appendChild(t); return r;
}

// --- Post element ---
function createPostElement(postData){
  const post = document.createElement('div'); post.className='post';

  // Header
  const header = document.createElement('div'); header.className='post-header';
  let usernameStr = postData.username;
  if(postData.isSponsored){
    const suffixes=['Corp.','Inc.','Group','LLC.','Ltd.','PLC','Co.'];
    usernameStr += ' '+suffixes[Math.floor(Math.random()*suffixes.length)];
  }
  const pfp = document.createElement('div'); pfp.className='pfp'; pfp.textContent=usernameStr.charAt(0).toUpperCase();
  const username = document.createElement('div'); username.className='username'; username.textContent=usernameStr;
  if(postData.isSponsored) username.style.color='#FFD700';
  const date = document.createElement('div'); date.className='date'; date.textContent=postData.date;
  header.appendChild(pfp); header.appendChild(username); header.appendChild(date);

  // Caption
  const caption = document.createElement('div'); caption.className='caption'; caption.textContent=postData.caption;

  // Image
  const imageContainer = document.createElement('div'); imageContainer.className='image-container';
  const canvas = generateNoiseFromSeed(postData.seed,50,50);
  imageContainer.appendChild(canvas);

  // Like bar
  const likeBar = document.createElement('div'); likeBar.className='like-bar';
  const heart = document.createElement('span'); heart.className='heart'; heart.textContent='♥';
  const likesCount = document.createElement('span'); likesCount.className='likes-count';
  let count = postData.likes; likesCount.textContent = count;
  likeBar.appendChild(heart); likeBar.appendChild(likesCount);
  let liked=false;
  likeBar.addEventListener('click',(e)=>{ e.stopPropagation(); liked=!liked; heart.classList.toggle('liked',liked); count+=liked?1:-1; likesCount.textContent=count; });

  // Replies
  const repliesContainer = document.createElement('div'); repliesContainer.className='replies';
  postData.replies.forEach(r => repliesContainer.appendChild(createReplyElement(r)));

  // Comments toggle
  const commentsToggle = document.createElement('button'); commentsToggle.className='comments-toggle';
  const repliesCount = postData.replies.length;
  commentsToggle.textContent=`Show Replies (${repliesCount})`;
  commentsToggle.addEventListener('click',(e)=>{ e.stopPropagation(); const visible = repliesContainer.classList.toggle('visible'); commentsToggle.textContent = visible?`Hide Replies (${repliesCount})`:`Show Replies (${repliesCount})`; });

  // Share button
  const shareBtn = document.createElement('button'); shareBtn.className='share-btn'; shareBtn.textContent='Share';
  shareBtn.addEventListener('click',(e)=>{
    e.stopPropagation();
    const link = `${location.origin}${location.pathname}?id=${encodePostData(postData)}`;
    showShareOverlay(link);
    });

  post.appendChild(header); post.appendChild(caption); post.appendChild(imageContainer);
  post.appendChild(likeBar); post.appendChild(commentsToggle); post.appendChild(repliesContainer); post.appendChild(shareBtn);

  post.addEventListener('click',()=>openPostPage(postData));
  return post;
}

// --- Generate new post ---
function generateRandomPost(){
  return {
    username: generateGarbledText(7),
    caption: generateGarbledText(40),
    date: createDateString(),
    replies: Array.from({length:Math.floor(Math.random()*12)+1},()=>generateGarbledText(Math.floor(Math.random()*8)+8)),
    likes: Math.floor(Math.random()*500),
    isSponsored: Math.random()<0.1,
    seed: Math.floor(Math.random()*1e9)
  };
}

// --- Open single post page ---
function openPostPage(postData){
  feed.style.display = 'none';
  loading.style.display = 'none';

  const postPage = document.createElement('div'); postPage.className = 'post-page'; postPage.id = 'single-post-page';

  const backBtn = document.createElement('button'); backBtn.className = 'back-btn'; backBtn.textContent='← Back to feed';
  backBtn.addEventListener('click',()=>{
    postPage.remove();
    feed.style.display = '';
    loading.style.display = '';
    history.replaceState({}, '', location.pathname);
  });

  postPage.appendChild(backBtn);
  postPage.appendChild(createPostElement(postData));
  document.body.appendChild(postPage);

  history.replaceState({}, '', `${location.pathname}?id=${encodePostData(postData)}`);
}

// --- Load posts ---
function loadPosts(count=10){
  for(let i=0;i<count;i++){
    const postData = generateRandomPost();
    mainFeed.push(postData);
    feed.appendChild(createPostElement(postData));
  }
}

// Infinite scroll
const observer = new IntersectionObserver(entries=>{ entries.forEach(e=>{ if(e.isIntersecting) loadPosts(10); }); });
observer.observe(loading);

// Check URL for shared post
window.addEventListener('load',()=>{
  const params = new URLSearchParams(location.search);
  const id = params.get('id');
  if(id){
    const postData = decodePostData(id);
    if(postData) openPostPage(postData);
    else loadPosts(20);
  } else loadPosts(20);
});
</script>
</body>
</html>
